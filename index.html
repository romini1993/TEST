<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>MULTI CRYPTO</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; 
            --text: #f8fafc; --subtext: #94a3b8; --up: #4ade80; --down: #f87171; 
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; justify-content: center; }
        
        /* Navigasi Bawah */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; max-width: 420px; height: 70px;
            background: #161e2e; display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid #334155; z-index: 1000;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--subtext); cursor: pointer; font-size: 12px; font-weight: bold; flex: 1; }
        .nav-item.active { color: var(--accent); }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        /* Container Utama */
        .app-shell { width: 100%; max-width: 420px; min-height: 100vh; position: relative; padding-bottom: 80px; }
        .tab-content { display: none; padding: 15px; }
        .tab-content.active { display: block; }

        /* Header Kurs Global (Pojok Kanan Atas) */
        .global-header {
            position: sticky; top: 0; display: flex; justify-content: flex-end;
            padding: 10px 15px; background: var(--bg); z-index: 999;
        }
        .kurs-info-global { font-size: 10px; color: var(--subtext); background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 8px; border: 1px solid #334155; }

        /* --- Gabungan CSS All Apps (Disederhanakan agar tidak bentrok) --- */
        .summary-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--accent); text-align: center; }
        .summary-idr { font-size: 26px; font-weight: 800; display: block; }
        .coin-row { position: relative; margin-bottom: 10px; }
        .coin-card { background: var(--card); border-radius: 12px; padding: 12px; display: flex; align-items: center; gap: 10px; border: 1px solid #334155; cursor: pointer; }
        .logo-wrapper { width: 34px; height: 34px; border-radius: 50%; overflow: hidden; border: 1px solid #475569; flex-shrink: 0; background: #000; display: flex; align-items: center; justify-content: center; }
        .logo-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .details { background: #161e2e; margin: -10px 5px 10px 5px; padding: 20px 15px 15px 15px; border-radius: 0 0 12px 12px; border: 1px solid #334155; }
        .source-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 8px; }
        .source-input { width: 100px; background: #000; border: 1px solid #475569; color: #fff; text-align: right; border-radius: 6px; padding: 4px; font-size: 13px; }
        .up { color: var(--up); } .down { color: var(--down); }
        .input-box-kurs input { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid #334155; border-radius: 6px; color: white; font-size: 16px; font-weight: bold; outline: none; padding: 6px 8px; }
        .apr-card { padding: 18px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 10px;}
        .currency-switch { display: flex; gap: 8px; margin-bottom: 25px; background: var(--card); padding: 4px; border-radius: 12px; }
        .currency-switch button { flex: 1; padding: 10px; border: none; border-radius: 9px; cursor: pointer; font-weight: bold; background: transparent; color: var(--subtext); }
        .currency-switch button.active { background: var(--accent); color: #0f172a; }
    </style>
</head>
<body>

<div class="app-shell">
    <div class="global-header">
        <div id="global-kurs-val" class="kurs-info-global">USD/IDR: Loading...</div>
    </div>

    <div id="tab-porto" class="tab-content active">
        <div class="brand" style="font-size: 20px; font-weight: bold; color: var(--accent); margin-bottom: 20px;">PORTOFOLIO</div>
        <div class="summary-card">
            <span style="font-size: 11px; color: var(--accent); letter-spacing: 1px;">TOTAL SALDO</span>
            <span id="porto-total-idr" class="summary-idr">Rp 0</span>
            <span id="porto-total-usd" style="color: var(--subtext); font-size: 14px;">$0.00</span>
        </div>
        <input type="text" id="porto-filter" style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #334155; border-radius: 12px; padding: 12px 15px; color: white; margin-bottom: 12px;" placeholder="Cari koin di list..." oninput="porto_render()">
        <div id="porto-list"></div>
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #334155;">
            <div style="display: flex; gap: 8px;">
                <input type="text" id="porto-add-input" style="flex:1; background: var(--card); border: 1px solid #334155; color: white; padding: 12px; border-radius: 10px;" placeholder="Tambah koin (misal: SUI)">
                <button onclick="porto_addCoin()" style="background: var(--accent); border: none; padding: 0 20px; border-radius: 10px; font-weight: bold;">+</button>
            </div>
        </div>
    </div>

    <div id="tab-kurs" class="tab-content">
        <div style="text-align:center; margin-bottom:20px;"><h2 style="color:var(--accent); margin:0;">ðŸ’± KURS</h2></div>
        <div id="kurs-fixed-list">
            <div class="coin-card" style="border-left: 4px solid #ef4444;">
                <div class="logo-wrapper"><img src="https://api.iconify.design/emojione:flag-for-indonesia.svg"></div>
                <div style="min-width:70px;"><label style="font-size:11px; color:var(--subtext); font-weight:bold;">IDR</label></div>
                <div class="input-box-kurs" style="flex:1;"><input type="text" id="kurs-idr" inputmode="decimal" placeholder="0" oninput="kurs_handle('idr')"></div>
            </div>
            <div style="height:10px"></div>
            <div class="coin-card" style="border-left: 4px solid #3b82f6;">
                <div class="logo-wrapper"><img src="https://api.iconify.design/emojione:flag-for-united-states.svg"></div>
                <div style="min-width:70px;"><label style="font-size:11px; color:var(--subtext); font-weight:bold;">USD</label></div>
                <div class="input-box-kurs" style="flex:1;"><input type="text" id="kurs-usd" inputmode="decimal" placeholder="0" oninput="kurs_handle('usd')"></div>
            </div>
        </div>
        <div id="kurs-watchlist" style="margin-top:10px"></div>
        <div style="margin-top:20px; border-top: 1px dashed #334155; padding-top:20px;">
            <div style="display:flex; gap:8px;">
                <input type="text" id="kurs-add-input" style="flex:1; background: var(--card); border: 1px solid #334155; color: white; padding: 12px; border-radius: 10px;" placeholder="Tambah koin (SUI, SOL)">
                <button onclick="kurs_addCoin()" style="background: var(--accent); border: none; padding: 0 15px; border-radius: 10px; font-weight: bold;">Tambah</button>
            </div>
        </div>
    </div>

    <div id="tab-apr" class="tab-content">
        <h2 style="color:var(--accent); margin-bottom:20px;">ðŸ’° APR Pro</h2>
        <div class="currency-switch">
            <button id="apr-btn-idr" class="active" onclick="apr_setCurr('IDR')">IDR (Rp)</button>
            <button id="apr-btn-usd" onclick="apr_setCurr('USD')">USD ($)</button>
        </div>
        <label style="display:block; font-size:13px; color:var(--subtext); margin-bottom:8px;">JUMLAH SALDO</label>
        <div style="background:var(--card); padding:16px; border-radius:16px; border:2px solid #334155; margin-bottom:20px;">
            <input type="text" id="apr-saldo" style="width:100%; background:transparent; border:none; color:white; font-size:22px; font-weight:bold; outline:none;" placeholder="0" oninput="apr_hitung()">
        </div>
        <label style="display:block; font-size:13px; color:var(--subtext); margin-bottom:8px;">BUNGA PER TAHUN (%)</label>
        <div style="background:var(--card); padding:16px; border-radius:16px; border:2px solid #334155; margin-bottom:20px;">
            <input type="text" id="apr-bunga" style="width:100%; background:transparent; border:none; color:white; font-size:22px; font-weight:bold; outline:none;" placeholder="0" oninput="apr_hitung()">
        </div>
        <div id="apr-results">
            <div class="apr-card" style="background: rgba(56, 189, 248, 0.08); color: #38bdf8;"><span style="font-size:10px; font-weight:bold; text-transform:uppercase;">Harian</span><br><span id="apr-harian" style="font-size:22px; font-weight:800;">0</span></div>
            <div class="apr-card" style="background: rgba(74, 222, 128, 0.08); color: #4ade80;"><span style="font-size:10px; font-weight:bold; text-transform:uppercase;">Bulanan</span><br><span id="apr-bulanan" style="font-size:22px; font-weight:800;">0</span></div>
            <div class="apr-card" style="background: rgba(251, 191, 36, 0.08); color: #fbbf24;"><span style="font-size:10px; font-weight:bold; text-transform:uppercase;">Tahunan</span><br><span id="apr-tahunan" style="font-size:22px; font-weight:800;">0</span></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="showTab('porto', this)"><div class="nav-icon">ðŸ“Š</div><span>Porto</span></div>
        <div class="nav-item" onclick="showTab('kurs', this)"><div class="nav-icon">ðŸ’±</div><span>Kurs</span></div>
        <div class="nav-item" onclick="showTab('apr', this)"><div class="nav-icon">ðŸ’°</div><span>APR</span></div>
    </div>
</div>

<script>
    let globalUsdToIdr = 16000;
    
    // GANTI TAB
    function showTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + id).classList.add('active');
        el.classList.add('active');
    }

    // KURS GLOBAL SYNC
    async function fetchKurs() {
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=idr');
            const d = await r.json();
            if(d.tether?.idr) {
                globalUsdToIdr = d.tether.idr;
                document.getElementById('global-kurs-val').innerText = `USD/IDR: ${Math.round(globalUsdToIdr).toLocaleString('id-ID')}`;
                // Update Porto & APR if they are visible
                porto_render(); 
                apr_hitung();
            }
        } catch(e) {}
    }

    // --- LOGIC PORTO ---
    let p_watchlist = JSON.parse(localStorage.getItem('my_assets_v2') || '["BTC", "ETH"]');
    let p_balances = JSON.parse(localStorage.getItem('my_balances_v2') || '{}');
    let p_prices = {};
    
    async function porto_fetch() {
        for(let s of p_watchlist) {
            try {
                const r = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${s}USDT`);
                const d = await r.json();
                if(d.price) p_prices[s] = parseFloat(d.price);
            } catch(e){}
        }
        porto_render();
    }

    function porto_render() {
        const list = document.getElementById('porto-list');
        list.innerHTML = ""; let totalUsd = 0;
        p_watchlist.forEach(s => {
            let p = p_prices[s] || 0;
            let bal = 0;
            if(p_balances[s]) Object.values(p_balances[s]).forEach(v => bal += parseFloat(v || 0));
            let vUsd = bal * p; totalUsd += vUsd;
            list.innerHTML += `<div class="coin-card">
                <div class="logo-wrapper"><img src="https://coinicons-api.vercel.app/api/icon/${s.toLowerCase()}"></div>
                <div style="flex:1"><b>${s}</b><br><small>$${p.toLocaleString()}</small></div>
                <div style="text-align:right"><b>${bal}</b><br><small style="color:var(--subtext)">$${vUsd.toFixed(2)}</small></div>
            </div>`;
        });
        document.getElementById('porto-total-usd').innerText = `$${totalUsd.toLocaleString(undefined, {minimumFractionDigits:2})}`;
        document.getElementById('porto-total-idr').innerText = `Rp ${Math.round(totalUsd * globalUsdToIdr).toLocaleString('id-ID')}`;
    }

    function porto_addCoin() {
        let val = document.getElementById('porto-add-input').value.toUpperCase().trim();
        if(val && !p_watchlist.includes(val)) { p_watchlist.push(val); localStorage.setItem('my_assets_v2', JSON.stringify(p_watchlist)); porto_fetch(); }
    }

    // --- LOGIC KURS ---
    let k_watchlist = JSON.parse(localStorage.getItem('kurs_fast_v3') || '[]');
    let k_prices = {};

    async function kurs_fetch() {
        for(let s of ['BTC','ETH',...k_watchlist]) {
            try {
                const r = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${s}USDT`);
                const d = await r.json();
                if(d.price) k_prices[s] = parseFloat(d.price);
            } catch(e){}
        }
        kurs_render();
    }

    function kurs_render() {
        const cont = document.getElementById('kurs-watchlist');
        cont.innerHTML = "";
        k_watchlist.forEach(s => {
            let p = k_prices[s] || 0;
            cont.innerHTML += `<div class="coin-card">
                <div class="logo-wrapper"><img src="https://coinicons-api.vercel.app/api/icon/${s.toLowerCase()}"></div>
                <div style="min-width:70px;"><label style="font-size:11px; font-weight:bold;">${s}</label><br><span style="font-size:10px; color:var(--accent)">$${p.toLocaleString()}</span></div>
                <div class="input-box-kurs" style="flex:1;"><input type="text" id="k-in-${s}" inputmode="decimal" placeholder="0" oninput="kurs_handle('${s}')"></div>
            </div><div style="height:10px"></div>`;
        });
    }

    function kurs_handle(src) {
        let val = parseFloat(document.getElementById(src === 'idr' ? 'kurs-idr' : (src === 'usd' ? 'kurs-usd' : 'k-in-'+src)).value.replace(/,/g,'')) || 0;
        let usdBase = src === 'idr' ? val / globalUsdToIdr : (src === 'usd' ? val : val * (k_prices[src] || 0));
        
        document.getElementById('kurs-idr').value = (usdBase * globalUsdToIdr).toLocaleString('en-US', {maximumFractionDigits:0});
        document.getElementById('kurs-usd').value = usdBase.toLocaleString('en-US', {maximumFractionDigits:2});
        k_watchlist.forEach(s => {
            let res = usdBase / (k_prices[s] || 1);
            document.getElementById('k-in-'+s).value = res.toLocaleString('en-US', {maximumFractionDigits:4});
        });
    }

    function kurs_addCoin() {
        let val = document.getElementById('kurs-add-input').value.toUpperCase().trim();
        if(val && !k_watchlist.includes(val)) { k_watchlist.push(val); localStorage.setItem('kurs_fast_v3', JSON.stringify(k_watchlist)); kurs_fetch(); }
    }

    // --- LOGIC APR ---
    let apr_curr = 'IDR';
    function apr_setCurr(c) { 
        apr_curr = c; 
        document.getElementById('apr-btn-idr').className = c === 'IDR' ? 'active' : '';
        document.getElementById('apr-btn-usd').className = c === 'USD' ? 'active' : '';
        apr_hitung(); 
    }

    function apr_hitung() {
        let saldo = parseFloat(document.getElementById('apr-saldo').value.replace(/,/g,'')) || 0;
        let bunga = parseFloat(document.getElementById('apr-bunga').value) || 0;
        let perThn = saldo * (bunga / 100);
        let perBln = perThn / 12;
        let perHari = perThn / 365;

        const fmt = (v) => apr_curr === 'IDR' ? 'Rp ' + Math.floor(v).toLocaleString('id-ID') : '$ ' + v.toLocaleString(undefined, {minimumFractionDigits:2});
        document.getElementById('apr-harian').innerText = fmt(perHari);
        document.getElementById('apr-bulanan').innerText = fmt(perBln);
        document.getElementById('apr-tahunan').innerText = fmt(perThn);
    }

    // ON LOAD
    window.onload = () => {
        fetchKurs();
        porto_fetch();
        kurs_fetch();
        setInterval(fetchKurs, 60000);
    };
</script>

</body>
</html>
